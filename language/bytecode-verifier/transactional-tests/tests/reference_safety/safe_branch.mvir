//# publish --address 0x42
module M {
    struct X has drop { f: u64, g: u64 }
    struct S has drop { x: Self.X }

    t1(cond: bool, s1: &mut Self.S, s2: &mut Self.S) {
        let imm: &u64;
        let mut_: &mut Self.X;
        if (move(cond)) {
            imm = &(&move(s1).x).f;
            mut_ = &mut move(s2).x;
        } else {
            imm = &(&move(s2).x).f;
            mut_ = &mut move(s1).x;
        };
        *move(mut_) = X { f: 1, g: 2 };
        assert(*move(imm) == 0, 42);
        return;
    }

}
